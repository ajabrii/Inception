# Sets the number of worker processes (usually = CPU cores)
# 1 is fine for development/small sites
worker_processes 1;

# Event processing model configuration
events {
    # Maximum number of simultaneous connections per worker process
    # Total connections = worker_processes Ã— worker_connections
    worker_connections 1024;
}

# Main HTTP configuration block
http {
    # Virtual server configuration
    server {
        # Listen on port 443 with SSL/TLS encryption enabled
        # This makes your site accessible via HTTPS
        listen 443 ssl;
        
        # Domain name this server block responds to
        # Must match your certificate's CN (Common Name)
        server_name ajabri.42.fr;

        # Path to SSL certificate file (public key)
        # Generated in your nginx dockerfile
        ssl_certificate     /etc/nginx/ssl/inception.crt;
        
        # Path to SSL private key file
        # Must be kept secure and never shared
        ssl_certificate_key /etc/nginx/ssl/inception.key;

        # Allowed SSL/TLS protocol versions
        # TLSv1.2 and TLSv1.3 are secure, older versions are deprecated
        ssl_protocols TLSv1.2 TLSv1.3;
        
        # SSL cipher suites configuration
        # HIGH: strong encryption, !aNULL: no anonymous ciphers, !MD5: no weak MD5
        ssl_ciphers HIGH:!aNULL:!MD5;

        # Document root directory where website files are stored
        # This is where WordPress files are mounted via Docker volume
        root /var/www/wordpress;
        
        # Default files to serve when accessing a directory
        # Try index.php first (WordPress), then index.html
        index index.php index.html;

        # Main location block - handles all requests
        location / {
            # Try to serve request as file, then directory, then WordPress index.php
            # This enables WordPress permalinks to work properly
            try_files $uri $uri/ /index.php?$args;
        }

        # Handle PHP files through FastCGI
        location ~ \.php$ {
            # Include standard FastCGI parameters
            include fastcgi_params;
            
            # Forward PHP requests to WordPress container on port 9000
            # 'wordpress' is the container name from docker-compose.yml
            fastcgi_pass wordpress:9000;
            
            # Default PHP file to process
            fastcgi_index index.php;
            
            # Tell PHP-FPM the full path to the script file
            # $document_root = /var/www/wordpress, $fastcgi_script_name = requested .php file
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        }

        # Security: block access to .htaccess and similar hidden files
        # Prevents exposure of sensitive configuration files
        location ~ /\.ht {
            deny all;
        }
    }
}
